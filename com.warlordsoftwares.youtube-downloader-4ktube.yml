app-id: com.warlordsoftwares.youtube-downloader-4ktube
runtime: org.kde.Platform
runtime-version: 5.15-24.08
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '5.15-24.08'
command: 4ktube.sh

tags:
  - proprietary

finish-args:
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=xdg-download
  - --filesystem=xdg-documents
  - --filesystem=xdg-run/gvfsd
  - --device=dri
  - --socket=pulseaudio
  - --env=QTWEBENGINEPROCESS_PATH=/app/bin/QtWebEngineProcess
  - --env=QTWEBENGINE_CHROMIUM_FLAGS=--no-sandbox
  - --env=QTWEBENGINE_DISABLE_SANDBOX=1
  - --env=QTWEBENGINE_RESOURCES_PATH=/app/share/qt5/resources
  - --env=QTWEBENGINE_LOCALES_PATH=/app/share/qt5/translations/qtwebengine_locales

cleanup-commands:
  - /app/cleanup-BaseApp.sh

cleanup:
  - /include
  - /lib/pkgconfig

modules:
#  - name: libass
#    buildsystem: autotools
#    config-opts:
#      - --disable-static
#    cleanup:
#      - /include
#      - /lib/*.la
#      - /lib/pkgconfig
#    sources:
#      - type: archive
#        url: https://github.com/libass/libass/releases/download/0.17.1/libass-0.17.1.tar.gz
#        sha256: d653be97198a0543c69111122173c41a99e0b91426f9e17f06a858982c2fb03d
#
  - name: luajit
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: git
        url: https://github.com/LuaJIT/LuaJIT.git
        commit: 4c2441c16ce3c4e312aaefecc6d40c4fe21de97c

  - ffmpeg.json
#  - mpv.json
#  - python3-req.json
#  - python3-yt-dlp.json

  - name: youtube-downloader-4ktube
    buildsystem: simple
    build-commands:
      - mkdir -p ${FLATPAK_DEST}/4ktube
      - cp -r * ${FLATPAK_DEST}/4ktube
      - install -Dm755 ${FLATPAK_DEST}/4ktube/4ktube.sh ${FLATPAK_DEST}/bin/4ktube.sh
      - install -Dm644 ${FLATPAK_DEST}/4ktube/share/icons/icon.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/com.warlordsoftwares.youtube-downloader-4ktube.png
      - install -Dm644 ${FLATPAK_DEST}/4ktube/share/applications/youtube-downloader-4ktube.desktop ${FLATPAK_DEST}/share/applications/com.warlordsoftwares.youtube-downloader-4ktube.desktop
      - desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/com.warlordsoftwares.youtube-downloader-4ktube.desktop
      - install -Dm644 ${FLATPAK_DEST}/4ktube/share/metainfo/com.warlordsoftwares.youtube-downloader-4ktube.metainfo.xml ${FLATPAK_DEST}/share/metainfo/com.warlordsoftwares.youtube-downloader-4ktube.metainfo.xml
    sources:
      - type: archive
        url: https://warlordsoftwares.com/static/app_builds/FLATPAK_4KTUBE-2025.6.5.tar.gz  # change path for prod
        sha256: e375fcd7720d7379dd4de2a3d3a86bd80d2126e890f038c8707202f1a82ba783
